#!/usr/bin/env ruby
require 'plist'

DAEMON_NAME = "com.workstation.set-hostname".freeze
DAEMON_FILE = "/Library/LaunchDaemons/#{DAEMON_NAME}.plist".freeze
SCRIPT = File.expand_path("../../maintenance/set_hostname", __FILE__)

plist = {
  Label: DAEMON_NAME,
  Program: SCRIPT,
  RunAtLoad: true,
  UserName: 'root'
}.to_plist

File.write(DAEMON_FILE, plist)

`launchctl unload #{DAEMON_FILE} 2> /dev/null`
`launchctl load #{DAEMON_FILE}`
